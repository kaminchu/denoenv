#!/usr/bin/env bash
set -e

version=$(cat $(dirname $0)/../version)
if [ -e $(pwd)/.deno-version ]; then
  version=$(cat $(pwd)/.deno-version)
fi

versions_dir=$(dirname $0)/../versions


export DENO_INSTALL_ROOT=$versions_dir/$version
$versions_dir/$version/deno "$@"

if [ "`echo $@ | grep -E 'install'`" ]; then
  ls $versions_dir | xargs -I{} ls $(dirname $0)/../versions/{}/bin | xargs -I{} cp $(dirname $0)/../scripts/deno_scripts_template.sh $(dirname $0)/../bin/$(basename {})
  chmod +x $(dirname $0)/../bin/*
fi
